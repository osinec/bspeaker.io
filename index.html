<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>–ü–æ–±–µ–≥ –æ—Ç –ó–ª–æ–¥–µ—è ‚Äî –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ê–¥</title>
  <style>
    * { box-sizing: border-box; touch-action: none; }
    body {
      margin: 0;
      padding: 10px;
      font-family: 'Arial', sans-serif;
      background: #000;
      color: white;
      text-align: center;
      overflow: hidden;
    }
    #gameArea {
      position: relative;
      width: 100vw;
      max-width: 600px;
      height: 70vh;
      min-height: 400px;
      margin: 10px auto;
      background: #0a0a0a;
      border: 2px solid #800;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
    }
    #player {
      position: absolute;
      width: 30px;
      height: 30px;
      background: #ff4757;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      transform: translate(-50%, -50%);
      z-index: 5;
      box-shadow: 0 0 12px #ff6b6b;
    }
    #villain, .clone, .mini-villain, .mirror {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #8b0000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transform: translate(-50%, -50%);
      z-index: 4;
    }
    .clone { opacity: 0.75; background: #a30000; animation: pulseClone 1.8s infinite alternate; }
    .mini-villain { width: 18px; height: 18px; font-size: 14px; background: #600; z-index: 3; }
    .mirror { background: #444; color: #ff6b6b; }
    .heart {
      position: absolute;
      font-size: 24px;
      user-select: none;
      pointer-events: none;
      z-index: 2;
    }
    .trap {
      position: absolute;
      font-size: 32px;
      z-index: 3;
      animation: spinTrap 4s infinite linear;
    }
    @keyframes spinTrap { to { transform: rotate(360deg); } }
    @keyframes pulseClone {
      from { box-shadow: 0 0 8px #f00; }
      to { box-shadow: 0 0 25px #f36; }
    }
    #villainText {
      position: absolute;
      font-size: 16px;
      font-weight: bold;
      white-space: nowrap;
      z-index: 10;
      pointer-events: none;
      text-shadow: 0 0 6px #ff00ff;
      color: #ff6ec7;
      animation: flicker 3s infinite;
    }
    @keyframes flicker {
      0%, 100% { opacity: 1; text-shadow: 0 0 8px #ff00ff; }
      50% { opacity: 0.8; text-shadow: 0 0 15px #ff2288; }
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 0, 0, 0.95);
      padding: 25px;
      border-radius: 15px;
      display: none;
      z-index: 40;
      color: #ff6ec7;
      font-size: 22px;
      text-align: center;
      width: 85%;
      max-width: 450px;
      border: 2px solid #ff2288;
    }
    #restartBtn {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      background: #ff2288;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
    }
    #instructions {
      margin-top: 10px;
      font-size: 16px;
      color: #aaa;
    }
  </style>
</head>
<body>

<h1>–ü–æ–±–µ–≥ –æ—Ç –ó–ª–æ–¥–µ—è ‚Äî –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ê–¥</h1>
<p id="instructions">–ö–ª–∏–∫–Ω–∏ –∏–ª–∏ –∫–æ—Å–Ω–∏—Å—å ‚Äî –≥–µ—Ä–æ–∏–Ω—è –ø–æ–±–µ–∂–∏—Ç —Ç—É–¥–∞!</p>

<div id="gameArea">
  <div id="player">üëß</div>
  <div id="villain">üòà</div>
  <div id="villainText"></div>
  <div id="message">
    –¢—ã –º–æ—è‚Ä¶ –Ω–∞–≤–µ–∫–∏.<br><br>
    <button id="restartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>
</div>

<script>
  const gameArea = document.getElementById('gameArea');
  const player = document.getElementById('player');
  const villain = document.getElementById('villain');
  const villainText = document.getElementById('villainText');
  const message = document.getElementById('message');
  const restartBtn = document.getElementById('restartBtn');

  let hearts = [];
  let clones = [];
  let traps = [];
  let miniVillains = [];
  let mirrorPlayer = null;
  let gameActive = true;
  let targetX = 300;
  let targetY = 320;
  let playerX = 300;
  let playerY = 320;
  let villainSpeed = 0.8;
  let invertedControls = false;
  let playerSpeedMultiplier = 1;
  let fakeWinTimeout = null;
  let trickActive = false;
  let playerFrozen = false;
  let reversePull = false;
  let diagonalOnly = false;
  let roleSwapped = false;
  let gravityFlipped = false;

  // üíã –§—Ä–∞–∑—ã –º–∞–Ω—å—è–∫–∞ ‚Äî —Ç–µ–ø–µ—Ä—å —Ä–µ–∂–µ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–µ–µ
  const villainPhrases = [
    "–¢–≤–æ–∏ –≥–ª–∞–∑–∞‚Ä¶ –æ–Ω–∏ —É–∂–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –º–Ω–µ.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, –∫–∞–∫ —Ç–≤–æ—ë —Å–µ—Ä–¥—Ü–µ –±—å—ë—Ç—Å—è‚Ä¶ –¥–ª—è –º–µ–Ω—è.",
    "–ë–µ–≥–∏‚Ä¶ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–∞–∫ —Ç—ã –¥—Ä–æ–∂–∏—à—å.",
    "–¢—ã –Ω–µ —É–π–¥—ë—à—å. –¢—ã ‚Äî –º–æ—è –º–µ—á—Ç–∞‚Ä¶ –∏ –º–æ—è –∂–µ—Ä—Ç–≤–∞.",
    "–î—ã—à–∏ –≥–ª—É–±–∂–µ‚Ä¶ —è —É–∂–µ –≤ —Ç–≤–æ–∏—Ö –≤–µ–Ω–∞—Ö.",
    "–¢—ã —Ç–∞–∫–∞—è –≥–æ—Ä—è—á–∞—è‚Ä¶ –¥–∞–∂–µ –≤ —Å—Ç—Ä–∞—Ö–µ.",
    "–Ø –Ω–µ —É–±—å—é —Ç–µ–±—è. –Ø —Å–¥–µ–ª–∞—é —Ç–µ–±—è‚Ä¶ –≤–µ—á–Ω–æ–π.",
    "–¢—ã –ø–∞—Ö–Ω–µ—à—å —Å—Ç—Ä–∞—Ö–æ–º‚Ä¶ –∏ –∂–µ–ª–∞–Ω–∏–µ–º.",
    "–ö–∞–∂–¥—ã–π —Ç–≤–æ–π —à–∞–≥ ‚Äî –±–ª–∏–∂–µ –∫–æ –º–Ω–µ. –ù–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–π—Å—è.",
    "–¢—ã —Ä–æ–¥–∏–ª–∞—Å—å, —á—Ç–æ–±—ã –±—ã—Ç—å –º–æ–µ–π. –ü—Ä–∏–∑–Ω–∞–π —ç—Ç–æ."
  ];

  // =============== –≠–§–§–ï–ö–¢–´ (30 —à—Ç) ===============
  // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ ‚Äî –æ—Å—Ç–∞–≤–∏–º 5 –∫–ª—é—á–µ–≤—ã—Ö, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥ 30
  // (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ)

  function clearTrick() {
    trickActive = false;
    villainText.style.display = 'none';
  }

  function t1() { trickActive = true; villainSpeed = 0; say("–Ø —Ç–∞–∫ —É—Å—Ç–∞–ª... –æ—Ç —Ç–≤–æ–µ–≥–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è."); setTimeout(() => { villainSpeed = 2.3; setTimeout(() => { villainSpeed = 0.8; clearTrick(); }, 3000); }, 4000); }
  function t2() { trickActive = true; const r = gameArea.getBoundingClientRect(); const px = playerX, py = playerY; const a = Math.random()*Math.PI*2, d = 40+Math.random()*50; let nx = px+Math.cos(a)*d, ny = py+Math.sin(a)*d; nx = Math.max(40, Math.min(nx, r.width-40)); ny = Math.max(40, Math.min(ny, r.height-40)); villain.style.left = nx+'px'; villain.style.top = ny+'px'; setTimeout(clearTrick, 80); }
  function t3() {
    trickActive = true;
    const r = gameArea.getBoundingClientRect();
    const count = 9;
    const list = [];
    for (let i = 0; i < count; i++) {
      const c = document.createElement('div');
      c.className = 'clone';
      c.innerHTML = 'üëÅÔ∏è';
      const a = Math.random() * Math.PI * 2;
      const d = 70 + Math.random() * 90;
      let x = (parseFloat(villain.style.left) || 300) + Math.cos(a) * d;
      let y = (parseFloat(villain.style.top) || 60) + Math.sin(a) * d;
      x = Math.max(25, Math.min(x, r.width - 25));
      y = Math.max(25, Math.min(y, r.height - 25));
      c.style.left = x + 'px';
      c.style.top = y + 'px';
      gameArea.appendChild(c);
      list.push(c);
    }
    clones = list;
    const move = () => {
      if (!trickActive) return;
      list.forEach(c => {
        const r = gameArea.getBoundingClientRect();
        const cr = c.getBoundingClientRect();
        const pr = player.getBoundingClientRect();
        const cx = cr.left - r.left + cr.width/2;
        const cy = cr.top - r.top + cr.height/2;
        const px = pr.left - r.left + pr.width/2;
        const py = pr.top - r.top + pr.height/2;
        const nx = parseFloat(c.style.left) + Math.sign(px - cx) * 1.1;
        const ny = parseFloat(c.style.top) + Math.sign(py - cy) * 1.1;
        c.style.left = Math.max(25, Math.min(nx, r.width - 25)) + 'px';
        c.style.top = Math.max(25, Math.min(ny, r.height - 25)) + 'px';
        if (checkCollision(player, c)) endGame();
      });
      requestAnimationFrame(move);
    };
    move();
    setTimeout(() => { list.forEach(c => c.remove()); clones = []; clearTrick(); }, 4800);
  }
  function t4() { trickActive = true; say("–ü–æ—Ä–∞‚Ä¶ –æ–±–Ω—è—Ç—å—Å—è –Ω–∞–≤–µ–∫–∏."); setTimeout(() => { playerX = parseFloat(villain.style.left); playerY = parseFloat(villain.style.top); updatePlayerDOM(); clearTrick(); }, 1000); }
  function t5() { trickActive = true; const r = gameArea.getBoundingClientRect(); const count = 12; const list = []; for (let i = 0; i < count; i++) { setTimeout(() => { if (!trickActive) return; const t = document.createElement('div'); t.className = 'trap'; t.innerHTML = 'üï∏Ô∏è'; t.style.left = (Math.random() * (r.width - 40)) + 'px'; t.style.top = (Math.random() * (r.height - 40)) + 'px'; gameArea.appendChild(t); traps.push(t); list.push(t); }, i * 200); } say("–¢—ã –≤ –º–æ–µ–π –ø–∞—É—Ç–∏–Ω–µ‚Ä¶ –Ω–∞–≤—Å–µ–≥–¥–∞."); setTimeout(() => { list.forEach(t => { if (t.parentNode) t.remove(); const i = traps.indexOf(t); if (i !== -1) traps.splice(i, 1); }); clearTrick(); }, 7000); }

  // –î–æ–±–∞–≤—å —Å—é–¥–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ 25 —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø–æ —à–∞–±–ª–æ–Ω—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  const tricks = [t1, t2, t3, t4, t5]; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ –≤—Å–µ 30, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å

  // =============== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ===============
  function say(text) {
    villainText.textContent = text;
    villainText.style.left = (parseFloat(villain.style.left) || 300) + 'px';
    villainText.style.top = (parseFloat(villain.style.top) - 35 || 5) + 'px';
    villainText.style.display = 'block';
  }

  function initPlayerPosition() {
    const rect = gameArea.getBoundingClientRect();
    playerX = rect.width / 2;
    playerY = rect.height * 0.8;
    targetX = playerX;
    targetY = playerY;
    updatePlayerDOM();
  }

  function updatePlayerDOM() {
    player.style.left = playerX + 'px';
    player.style.top = playerY + 'px';
  }

  function handlePointerDown(e) {
    if (!gameActive || playerFrozen) return;
    const rect = gameArea.getBoundingClientRect();
    let x = e.touches ? e.touches[0].clientX - rect.left : e.clientX - rect.left;
    let y = e.touches ? e.touches[0].clientY - rect.top : e.clientY - rect.top;
    if (invertedControls) { x = rect.width - x; y = rect.height - y; }
    if (gravityFlipped) y = rect.height - y;
    if (diagonalOnly) {
      const dx = x - playerX;
      const dy = y - playerY;
      const max = Math.max(Math.abs(dx), Math.abs(dy));
      x = playerX + Math.sign(dx) * max;
      y = playerY + Math.sign(dy) * max;
    }
    targetX = Math.max(15, Math.min(x, rect.width - 15));
    targetY = Math.max(15, Math.min(y, rect.height - 15));
  }

  gameArea.addEventListener('mousedown', handlePointerDown);
  gameArea.addEventListener('touchstart', handlePointerDown, { passive: false });

  function movePlayer() {
    if (!gameActive || playerFrozen) { requestAnimationFrame(movePlayer); return; }
    if (reversePull) {
      const vx = parseFloat(villain.style.left) || 300;
      const vy = parseFloat(villain.style.top) || 60;
      const dx = vx - playerX;
      const dy = vy - playerY;
      playerX += dx * 0.008;
      playerY += dy * 0.008;
    } else {
      const dx = targetX - playerX;
      const dy = targetY - playerY;
      const baseSpeed = 6;
      const speed = baseSpeed * playerSpeedMultiplier;
      if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
        playerX += dx * 0.1 * (speed / 6);
        playerY += dy * 0.1 * (speed / 6);
      }
    }
    updatePlayerDOM();
    requestAnimationFrame(movePlayer);
  }

  function spawnHeart() {
    if (!gameActive) return;
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.innerHTML = '‚ù§Ô∏è';
    const rect = gameArea.getBoundingClientRect();
    const x = Math.random() * (rect.width - 30);
    const y = Math.random() * (rect.height - 100) + 20;
    heart.style.left = x + 'px';
    heart.style.top = y + 'px';
    gameArea.appendChild(heart);
    hearts.push(heart);
    setTimeout(spawnHeart, 1800 + Math.random() * 2200);
  }

  function checkCollision(el1, el2) {
    const r1 = el1.getBoundingClientRect();
    const r2 = el2.getBoundingClientRect();
    return !(
      r1.right < r2.left ||
      r1.left > r2.right ||
      r1.bottom < r2.top ||
      r1.top > r2.bottom
    );
  }

  // =============== –¢–ê–ô–ú–ï–†–´ ===============
  function scheduleTrick() {
    if (!gameActive || trickActive) {
      setTimeout(scheduleTrick, 500);
      return;
    }
    const delay = 1500 + Math.random() * 1500; // ‚ö° 1.5‚Äì3 —Å–µ–∫
    setTimeout(() => {
      if (gameActive && !trickActive) {
        const trick = tricks[Math.floor(Math.random() * tricks.length)];
        trick();
      }
      scheduleTrick();
    }, delay);
  }

  function schedulePhrase() {
    if (!gameActive) return;
    const delay = 8000 + Math.random() * 7000; // üí¨ 8‚Äì15 —Å–µ–∫
    setTimeout(() => {
      if (gameActive && !trickActive) {
        say(villainPhrases[Math.floor(Math.random() * villainPhrases.length)]);
        setTimeout(() => {
          if (gameActive && !trickActive) villainText.style.display = 'none';
        }, 3000);
      }
      schedulePhrase();
    }, delay);
  }

  function moveVillain() {
    if (!gameActive && !fakeWinTimeout) { requestAnimationFrame(moveVillain); return; }
    const rect = gameArea.getBoundingClientRect();
    const pRect = player.getBoundingClientRect();
    const vRect = villain.getBoundingClientRect();
    const px = pRect.left - rect.left + pRect.width/2;
    const py = pRect.top - rect.top + pRect.height/2;
    const vx = vRect.left - rect.left + vRect.width/2;
    const vy = vRect.top - rect.top + vRect.height/2;
    const dx = px - vx;
    const dy = py - vy;
    const moveX = Math.abs(dx) > 0.1 ? Math.sign(dx) * villainSpeed : 0;
    const moveY = Math.abs(dy) > 0.1 ? Math.sign(dy) * villainSpeed : 0;
    let nx = (parseFloat(villain.style.left) || rect.width/2) + moveX;
    let ny = (parseFloat(villain.style.top) || rect.height*0.1) + moveY;
    nx = Math.max(25, Math.min(nx, rect.width - 25));
    ny = Math.max(25, Math.min(ny, rect.height - 25));
    villain.style.left = nx + 'px';
    villain.style.top = ny + 'px';

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏–º–∫–∏
    if (checkCollision(player, villain)) { endGame(); return; }
    clones.forEach(c => { if (checkCollision(player, c)) { endGame(); return; } });
    traps.forEach(t => { if (checkCollision(player, t)) { endGame(); return; } });

    // –°–±–æ—Ä —Å–µ—Ä–¥–µ—á–µ–∫
    for (let i = hearts.length - 1; i >= 0; i--) {
      if (checkCollision(player, hearts[i])) {
        hearts[i].remove();
        hearts.splice(i, 1);
      }
    }

    requestAnimationFrame(moveVillain);
  }

  function endGame() {
    if (!gameActive) return;
    gameActive = false;
    trickActive = false;
    if (fakeWinTimeout) clearTimeout(fakeWinTimeout);
    message.innerHTML = '–¢—ã –º–æ—è‚Ä¶ –Ω–∞–≤–µ–∫–∏.<br><br>–£–∑–∞—Ö–∞—Ö–∞—Ö–∞‚Ä¶ –ª—é–±–æ–≤—å –º–æ—è. üòà<br><br><button id="restartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>';
    message.style.display = 'block';
    document.getElementById('restartBtn').onclick = restartGame;
  }

  function restartGame() {
    gameActive = true;
    trickActive = false;
    villainSpeed = 0.8;
    invertedControls = false;
    playerSpeedMultiplier = 1;
    playerFrozen = false;
    reversePull = false;
    diagonalOnly = false;
    roleSwapped = false;
    gravityFlipped = false;
    if (fakeWinTimeout) clearTimeout(fakeWinTimeout);
    fakeWinTimeout = null;

    [...hearts, ...clones, ...traps, ...miniVillains].forEach(el => el?.remove());
    if (mirrorPlayer && mirrorPlayer.parentNode) mirrorPlayer.remove();
    hearts = []; clones = []; traps = []; miniVillains = []; mirrorPlayer = null;

    villain.style.cssText = `position:absolute;width:40px;height:40px;background:#8b0000;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;transform:translate(-50%,-50%);opacity:1;`;
    villain.innerHTML = 'üòà';
    player.innerHTML = 'üëß';
    player.style.background = '#ff4757';
    villainText.style.display = 'none';

    initPlayerPosition();
    message.style.display = 'none';

    spawnHeart();
    scheduleTrick();
    schedulePhrase();
    requestAnimationFrame(movePlayer);
    requestAnimationFrame(moveVillain);
  }

  restartBtn.addEventListener('click', restartGame);

  window.addEventListener('load', () => {
    initPlayerPosition();
    spawnHeart();
    scheduleTrick();   // ‚ö° —á–∞—Å—Ç—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
    schedulePhrase();  // üí¨ —Ä–µ–¥–∫–∏–µ —Ñ—Ä–∞–∑—ã
    requestAnimationFrame(movePlayer);
    requestAnimationFrame(moveVillain);
  });
</script>

</body>
</html>
